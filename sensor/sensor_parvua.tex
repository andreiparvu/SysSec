% IMPORTANT: add or remove (comment out) the boolean '\solutiontrue' below to
% create the solution document or the exercise document respectively.
% First we create the switch to make either the exercises or the solutions
\newif\ifsolution\solutionfalse
% To create the solution uncomment '\solutiontrue'
\solutiontrue

\documentclass[a4paper,11pt]{article}

\title{System Security,
\ifsolution Solution \else \fi
RSA and Sensor Node}

\include{author}


\usepackage[T1]{fontenc}
\usepackage{ae, aecompl}
\usepackage{a4wide}
\usepackage{boxedminipage}
\usepackage{url}
\usepackage{graphicx}
\usepackage{enumerate}
\usepackage{hyperref}

% Some useful commands and environments
\usepackage{framed}
\newenvironment{solution}%
{\par{\noindent\small\textit{Solution:}}\vspace{-12pt}\begin{framed}}%
{\end{framed}\par}

\begin{document}
\maketitle

\section{Why does RSA work?}
Given plain-text~\emph{P}, an RSA Key pair~(public key (\emph{E},\emph{N}) and
private key (\emph{D}, \emph{N})) and cipher-text~\emph{C}, what are the
mathematical expressions that describe RSA encryption and decryption, i.e.,
what is the relationship between \emph{P} and \emph{C}? Prove that the
equation for decryption is correct, i.e., detail the mathematical theorems
that result in this equation.
\ifsolution\begin{solution}
$N$ has been chosen so that it is a product of two large primes, ($N = P * Q$).
Then, $E$ is selected as being a random number, with $E$ less than and co-prime with
$\phi(N) = (P - 1) * (Q - 1)$. $(E, N)$ then forms the public key.\\
The private key will be the pair $(D, N)$ , with $D$ being chosen such that
$D$ with $E * D \equiv 1 \pmod{\phi(N)}$.\\
Given these properties, we can analyse the encryption and descryption.
\begin{itemize}
  \item encryption: given plaintext $p$, ciphertext $c$ will be $c = (p^E) \% N$.
  \item decryption: we compute $(c^D) \% N$, which will be equal to $(p^{E * D} \% N) =
  (p^{k * \phi(N) + 1}) \% N = ((p^{k * \phi(N)}) \% N) * (p \% N)) \% N$. Now, given
  that $p$ and $N$ are coprime, we can use Euler Theorem \cite{eulerth} which states
  that $a^{\phi(n)} \equiv 1 \pmod{n}$. Hence, $(c^D) \% N = p \% N = p$, so we recovered
  the plaintext from the ciphertext.
\end{itemize}

\end{solution}\fi

\section{A JTAG-based attack}
In this week's exercise, the goal is to find the private key by analyzing the
firmware image. This image was obtained from a sensor node through its JTAG
interface. The goal of this exercise is to also give you some insight into JTAG
interfaces, their use and security implications.

The necessary information can be found in the \texttt{sensor} directory.

We assume that we already know the public key of the node: the public exponent
$e$ is {\tt 0x5abb} and the modulus $n$ is {\tt 0x1d7 777c 3886 3aec 21ba 2d91
ee0f af51}. But are we able to find the private key from the firmware image in
rsa.txt?

\begin{enumerate}[(a)]

\item Please read about JTAG. How does it work? What is its intended use? What
are the security implications of an active JTAG interface when an attacker has
direct access to a device?

\item What is the format of the dumped image? Is it easy to guess the key
directly from this format?

\emph{Hint 1: The format is typical for programming microcontrollers, EPROMs,
etc.}
\\
\emph{Hint 2: You might need to extract the assembly code instructions by converting
it to a msp430 binary and then disassemble it.}
\\
\emph{Hint 3: Remember that the image was generated by a memory dump. It
contains a data and a text section. However, the disassembler might not be able
to tell the difference.}

\ifsolution\begin{solution}
WRITE HERE.
\end{solution}\fi

\item What is the key that you found? Which hints helped you to
locate/extract it? Verify that you found the correct key. Describe your
verification procedure!
\ifsolution\begin{solution}
WRITE HERE.
\end{solution}\fi

\end{enumerate}

\begin{thebibliography}{1}
\bibitem{eulerth} \href{http://en.wikipedia.org/wiki/Euler's_theorem}{Euler's Theorem}.
\end{thebibliography}

\end{document}
